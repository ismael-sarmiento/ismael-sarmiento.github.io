<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ismael A. Sarmiento — Data Journey CV (EN)</title>
  <meta name="description" content="Interactive CV of Ismael A. Sarmiento — Lead Data Engineer. Full-screen horizontal journey with smooth transitions and an immersive intro." />
  <meta name="theme-color" content="#0b1020" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ctext y='1em' font-size='96'%3E🧭%3C/text%3E%3C/svg%3E">

  <style>
  /* =======================================================================
     THEME & TOKENS  —  (EDITABLE) Colors, fonts, base sizes
     - Adjust your palette and typography here
     ======================================================================= */
  :root{
    --bg:#0b1020; --fg:#e6e9ef; --muted:#a4adbb;
    --card:#101731; --border:#1e2748; --shadow:0 16px 50px rgba(0,0,0,.35);
    --accent:#6aa3ff; --accent2:#2fe6c7;
    --radius:22px; --maxw:1180px;
    --menu-fz:14.5px;

    /* Loader — (EDITABLE) */
    --loader-title-fz-min:26px;  --loader-title-fz-vw:3vw;  --loader-title-fz-max:36px;
    --loader-kw-fz-min:14px;     --loader-kw-fz-vw:2.1vw;  --loader-kw-fz-max:22px;
  }
  [data-theme="light"]{
    --bg:#f5f7ff; --fg:#0b1020; --muted:#4e5d78;
    --card:#ffffff; --border:#dfe7ff; --shadow:0 14px 40px rgba(5,10,30,.08);
    --accent:#2f68ff; --accent2:#00baa1;
  }

  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{
    margin:0;
    font-family:Inter, -apple-system, Segoe UI, Roboto, system-ui, Arial;
    background:var(--bg); color:var(--fg); line-height:1.6; overflow-x:hidden
  }
  a{color:var(--accent); text-decoration:none}
  a:hover{text-decoration:none}

  /* =======================================================================
     BACKGROUND — soft animated gradients (disabled if prefers-reduced-motion)
     ======================================================================= */
  .bg{position:fixed; inset:-12vmax; z-index:-3; filter:blur(60px) saturate(140%);
    background:
      radial-gradient(36vmax 36vmax at 12% 25%, rgba(106,163,255,.35), transparent 60%),
      radial-gradient(36vmax 36vmax at 88% 20%, rgba(47,104,255,.35), transparent 60%),
      radial-gradient(36vmax 36vmax at 82% 86%, rgba(47,230,199,.30), transparent 60%),
      radial-gradient(36vmax 36vmax at 18% 78%, rgba(0,186,161,.28), transparent 60%);
    animation:float 24s ease-in-out infinite alternate}
  .bg2{position:fixed; inset:-14vmax; z-index:-2; pointer-events:none; filter:blur(70px) saturate(140%);
    background:
      radial-gradient(28vmax 28vmax at 20% 30%, rgba(106,163,255,.20), transparent 60%),
      radial-gradient(28vmax 28vmax at 80% 75%, rgba(47,230,199,.18), transparent 60%);
    animation:float2 38s ease-in-out infinite alternate}
  @keyframes float{0%{transform:translate(-1%,-1%) scale(1)}100%{transform:translate(1%,1%) scale(1.03)}}
  @keyframes float2{0%{transform:translate(-1%,1%) rotate(0.2deg)}100%{transform:translate(1%,-1%) rotate(-0.2deg)}}
  @media (prefers-reduced-motion:reduce){.bg,.bg2{animation:none}}

  /* =======================================================================
     LOADER (keywords + progressbar) — centered from the first frame
     - Titles & keywords adjustable via CSS variables above
     - Smooth and accessible animations
     ======================================================================= */
  #loader{
    position:fixed; inset:0; z-index:999; display:grid; place-items:center;
    background:radial-gradient(120vmax 120vmax at 50% 50%, #0b1020 20%, #050911 100%);
    color:#e6e9ef
  }
  .loader__inner{ display:grid; gap:16px; place-items:center; text-align:center }
  .loader__title{
    font-size:clamp(var(--loader-title-fz-min), var(--loader-title-fz-vw), var(--loader-title-fz-max));
    letter-spacing:.2px;
    background:conic-gradient(from 210deg, var(--accent,#6aa1ff), var(--accent2,#9effe8));
    -webkit-background-clip:text; background-clip:text; color:transparent
  }

  /* Fixed size avoids layout jumping between terms */
  .loader__ticker{
    position:relative;
    width:min(90vw, 820px);
    height:clamp(28px, 5vw, 52px);
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
  }

  /* Keyword is absolutely centered from the first frame */
  .loader__kw{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%, 10px) scale(.985);
    display:inline-block; font-weight:800; letter-spacing:.2px;
    font-size:clamp(var(--loader-kw-fz-min), var(--loader-kw-fz-vw), var(--loader-kw-fz-max));
    line-height:1.15;
    background:linear-gradient(90deg, var(--accent,#6aa1ff), var(--accent2,#9effe8));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    opacity:0; animation:kwIn .8s cubic-bezier(.2,.8,.2,1) forwards; /* slightly faster */
  }
  .loader__kw--out{ animation:kwOut .7s cubic-bezier(.2,.8,.2,1) forwards; }
  @keyframes kwIn   { to{ opacity:1; transform:translate(-50%, 0) scale(1) } }
  @keyframes kwOut  { to{ opacity:0; transform:translate(-50%, -8px) scale(.985) } }

  .fade-out{ animation:fadeout .7s ease forwards }
  @keyframes fadeout{ to{ opacity:0; visibility:hidden } }

  .loader__progress{
    position:relative; width:min(72vw, 540px);
    margin-top:6px; padding-top:18px;
  }
  .loader__bar{
    height:6px; width:100%;
    transform:scaleX(0); transform-origin:left;
    background:linear-gradient(90deg, var(--accent,#6aa1ff), var(--accent2,#9effe8));
    border-radius:999px; box-shadow:0 0 20px rgba(0,0,0,.25) inset;
  }
  .loader__pct{
    position:absolute; top:0; right:0;
    font-variant-numeric:tabular-nums; font-size:12px; color:rgba(230,233,239,.8)
  }

  @media (prefers-reduced-motion: reduce){
    .loader__kw{ animation:none; opacity:1; transform:translate(-50%, 0) scale(1) }
    .loader__kw--out{ animation:none; opacity:0 }
  }

  /* =======================================================================
     NAV / BRAND
     ======================================================================= */
  .nav{position:sticky; top:0; z-index:50; background:transparent; border:none}
  .nav__inner{max-width:var(--maxw); margin:0 auto; padding:14px 12px 0 12px; display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:8px}
  @media (max-width: 640px){ .nav__inner{padding:12px 8px 0 8px} }

  .brand-wrap{justify-self:center; position:relative; display:grid; place-items:center}
  .brand{display:grid; gap:2px; text-align:center; color:var(--fg)}
  .brand__l1{font-weight:900; font-size:clamp(24px,3.3vw,36px); letter-spacing:.2px; color:var(--accent); text-shadow:0 8px 24px rgba(0,0,0,.28); transition:text-shadow .35s ease, filter .35s ease}
  .brand__l2{font-weight:700; font-size:clamp(14px,1.7vw,18px); color:var(--fg); opacity:.9}
  .brand-wrap:hover .brand__l1{filter:brightness(1.08); text-shadow:0 14px 36px rgba(0,0,0,.38)}
  @keyframes titleBreath{0%,100%{text-shadow:0 8px 24px rgba(0,0,0,.28)}50%{text-shadow:0 10px 30px rgba(0,0,0,.34)}}
  .brand .brand__l1{animation:titleBreath 5s ease-in-out infinite}
  .brand:focus{outline:none}
  .brand-hint{position:absolute; left:-18px; top:50%; transform:translate(-100%,-50%); max-width:360px; padding:10px 12px; border-radius:12px; border:1px dashed color-mix(in oklab, var(--accent) 25%, var(--border)); background:color-mix(in oklab, var(--card) 85%, transparent); color:var(--muted); font-size:13px; line-height:1.4; box-shadow:var(--shadow); opacity:0; pointer-events:none; transition:opacity .18s ease, transform .18s ease}
  @media (hover:hover){ .brand-wrap:hover .brand-hint{opacity:1; transform:translate(-100%,-50%) scale(1.02)} }
  @media (max-width: 800px){ .brand-hint{display:none} }

  .nav__actions{justify-self:end; display:flex; gap:8px; align-items:center; margin-right:calc(env(safe-area-inset-right) + 6px)}
  .icon-btn{width:44px; height:44px; border-radius:999px; border:1px solid var(--border); background:color-mix(in oklab, var(--card) 85%, transparent); color:var(--fg); box-shadow:var(--shadow); display:grid; place-items:center}
  @media (max-width: 640px){ .icon-btn{width:46px; height:46px} }
  .ico{font-size:18px}
  .ico-globe{width:22px; height:22px; background:conic-gradient(from 0deg, var(--accent), var(--accent2)); -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23000"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm7.94 9h-3.09a16.6 16.6 0 0 0-1.15-5.03A8.02 8.02 0 0 1 19.94 11ZM8.3 13h7.4a14.9 14.9 0 0 1-1.05 4.37A14.9 14.9 0 0 1 12 20a14.9 14.9 0 0 1-2.65-2.63A14.9 14.9 0 0 1 8.3 13Zm0-2a14.9 14.9 0 0 1 1.05-4.37A14.9 14.9 0 0 1 12 4c.98 0 1.92.19 2.65.63A14.9 14.9 0 0 1 15.7 11H8.3ZM7.3 5.97A16.6 16.6 0 0 0 6.15 11H3.06a8.02 8.02 0 0 1 4.24-5.03ZM4.06 13h3.09c.24 1.79.67 3.47 1.15 5.03A8.02 8.02 0 0 1 4.06 13Zm15.88 0a8.02 8.02 0 0 1-4.24 5.03c.48-1.56.91-3.24 1.15-5.03h3.09Z"/></svg>') center/contain no-repeat; mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23000"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm7.94 9h-3.09a16.6 16.6 0 0 0-1.15-5.03A8.02 8.02 0 0 1 19.94 11ZM8.3 13h7.4a14.9 14.9 0 0 1-1.05 4.37A14.9 14.9 0 0 1 12 20a14.9 14.9 0 0 1-2.65-2.63A14.9 14.9 0 0 1 8.3 13Zm0-2a14.9 14.9 0 0 1 1.05-4.37A14.9 14.9 0 0 1 12 4c.98 0 1.92.19 2.65.63A14.9 14.9 0 0 1 15.7 11H8.3ZM7.3 5.97A16.6 16.6 0 0 0 6.15 11H3.06a8.02 8.02 0 0 1 4.24-5.03ZM4.06 13h3.09c.24 1.79.67 3.47 1.15 5.03A8.02 8.02 0 0 1 4.06 13Zm15.88 0a8.02 8.02 0 0 1-4.24 5.03c.48-1.56.91-3.24 1.15-5.03h3.09Z"/></svg>') center/contain no-repeat}
  .ico-theme{width:22px; height:22px}
  [data-theme="light"] .ico-theme{background:#ffb400; -webkit-mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23000"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42Zm10.45 0 1.79-1.79 1.41 1.41-1.79 1.8-1.41-1.42ZM12 4h0V1h0v3Zm0 19h0v-3h0v3Zm8-8h3v0h-3v0ZM1 12H4v0H1v0Zm2.54 6.36-1.41 1.41 1.8 1.79 1.41-1.41-1.8-1.79Zm15.92 0 1.41 1.41-1.79 1.8-1.41-1.41 1.79-1.8ZM12 7a5 5 0 1 0 .001 10.001A5 5 0 0 0 12 7Z"/></svg>') center/contain no-repeat}
  [data-theme="dark"] .ico-theme{background:#e6e9ef; -webkit-mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23000"><path d="M20.742 13.045A8 8 0 1 1 10.955 3.258 7 7 0 1 0 20.742 13.045Z"/></svg>') center/contain no-repeat}
  .ico-gear{width:22px; height:22px; background:#e6e9ef; -webkit-mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23000"><path d="M19.14,12.94a7.46,7.46,0,0,0,.05-1,7.46,7.46,0,0,0-.05-1l2.11-1.65a.5.5,0,0,0,.12-.64l-2-3.46a.5.5,0,0,0-.6-.22l-2.49,1a7.28,7.28,0,0,0-1.73-1l-.38-2.65A.5.5,0,0,0,12,1H8a.5.5,0,0,0-.5.42L7.12,4.07a7.28,7.28,0,0,0-1.73,1l-2.49-1a.5.5,0,0,0-.6.22l-2,3.46a.5.5,0,0,0,.12.64L2.53,10a7.46,7.46,0,0,0-.05,1,7.46,7.46,0,0,0,.05,1L.42,13.65a.5.5,0,0,0-.12.64l2,3.46a.5.5,0,0,0,.6.22l2.49-1a7.28,7.28,0,0,0,1.73,1l.38,2.65A.5.5,0,0,0,8,23h4a.5.5,0,0,0,.5-.42l.38-2.65a7.28,7.28,0,0,0,1.73-1l2.49,1a.5.5,0,0,0,.6-.22l2-3.46a.5.5,0,0,0,.12-.64ZM10,15a3,3,0,1,1,3-3A3,3,0,0,1,10,15Z"/></svg>') center/contain no-repeat}

  /* Menus with submenus (open to the right / stack on mobile) */
  .menu{position:relative}
  .menu__list{position:absolute; right:0; top:calc(100% + 8px); min-width:230px; background:color-mix(in oklab, var(--card) 92%, transparent); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:8px; display:none; font-size:var(--menu-fz)}
  .menu[aria-expanded="true"] > .menu__list{display:block}
  .menu__row{position:relative; display:block; padding:0; margin:0}
  .menu__parent, .menu__item{display:block; width:100%; padding:10px 12px; border-radius:10px; color:var(--fg); background:none; border:none; text-align:left; cursor:pointer; font:inherit}
  .menu__item:hover, .menu__parent:hover{background:color-mix(in oklab, var(--card) 80%, transparent)}
  .menu__parent{display:flex; align-items:center; justify-content:space-between}
  .menu__parent::after{content:"▸"; opacity:.7}
  .menu__row[aria-expanded="true"] > .menu__parent::after{content:"▾"}
  .submenu{position:absolute; left:calc(100% + 8px); top:-8px; min-width:220px; background:color-mix(in oklab, var(--card) 96%, transparent); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:8px; display:none}
  .menu__row[aria-expanded="true"] > .submenu{display:block}
  @media (max-width: 640px){ .submenu{position:relative; left:0; top:0; margin-top:6px} }

  /* =======================================================================
     HORIZONTAL RAIL / PAGES
     ======================================================================= */
  #rail{display:flex; gap:0; align-items:stretch; overflow-x:auto; overscroll-behavior-x:contain; scroll-snap-type:x mandatory; scrollbar-width:none}
  #rail::-webkit-scrollbar{display:none}
  .page{flex:0 0 100vw; max-width:100vw; min-height:100svh; display:grid; place-items:center; position:relative; scroll-snap-align:start; scroll-snap-stop:always}
  .page__inner{width:min(100%, var(--maxw)); padding:36px 22px; display:grid; gap:20px; opacity:.6; transform:translateY(6px); transition:opacity 1.35s ease, transform 1.35s ease}
  .page.active .page__inner{opacity:1; transform:none}
  @media (max-width: 640px){ .page__inner{padding:22px 14px} }

  .title{margin:0; text-align:center; font-size:clamp(24px, 4vw, 44px); font-weight:750; letter-spacing:.2px; color:var(--accent); text-shadow:0 8px 24px rgba(0,0,0,.28); transition:text-shadow .35s ease, filter .35s ease}
  .title:hover{filter:brightness(1.08); text-shadow:0 14px 36px rgba(0,0,0,.38)}
  .page.active .title{animation:titleBreath 5s ease-in-out infinite}

  .page--about .page__inner{grid-template-rows:auto auto auto 1fr}
  .page--about .intro{font-size:18px; color:var(--muted); text-align:center; margin:0 auto; max-width:820px}

  .card{background:transparent; border:1px dashed color-mix(in oklab, var(--accent) 25%, var(--border)); border-radius:var(--radius); padding:20px; backdrop-filter:blur(8px); box-shadow:0 0 0 1px rgba(255,255,255,.03) inset}

  .meta-cloud{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
  .meta-chip{position:relative; font-size:13px; padding:10px 12px; border-radius:14px; background:color-mix(in oklab, var(--card) 65%, transparent); border:1px solid var(--border); transform:translateZ(0); transition:transform .18s ease, box-shadow .18s ease}
  .meta-chip:hover{transform:scale(1.08); box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .meta-chip::after{content:attr(data-desc); position:absolute; left:50%; transform:translateX(-50%); bottom:calc(100% + 10px); white-space:nowrap; font-size:12px; color:var(--fg); background:color-mix(in oklab, var(--card) 85%, transparent); border:1px solid var(--border); padding:6px 8px; border-radius:10px; opacity:0; pointer-events:none; transition:opacity .18s ease}
  .meta-chip:hover::after{opacity:1}

  .exp-grid,.proj-grid,.edu-grid,.cert-grid{display:grid; gap:16px; max-width:980px; margin:0 auto}
  .accordion{border:1px dashed color-mix(in oklab, var(--accent) 25%, var(--border)); border-radius:16px; overflow:hidden; background:transparent}
  .accordion summary{list-style:none; cursor:pointer; display:flex; align-items:center; justify-content:space-between; padding:14px 18px}
  .accordion summary::-webkit-details-marker{display:none}
  .acc-title{font-weight:700}
  .chev{width:10px; height:10px; border-right:2px solid var(--fg); border-bottom:2px solid var(--fg); transform:rotate(-45deg); transition:transform .25s ease}
  .accordion[open] .chev{transform:rotate(45deg)}
  .acc-body{padding:0 18px 14px}

  .controls{position:fixed; left:50%; transform:translateX(-50%); bottom:22px; z-index:60; display:flex; gap:12px; align-items:center}
  .ctrl{width:46px; height:46px; border-radius:999px; border:1px solid var(--border); background:color-mix(in oklab, var(--card) 85%, transparent); color:var(--fg); box-shadow:var(--shadow); transition:transform .18s ease, box-shadow .18s ease, outline-color .18s ease}
  .ctrl--prev:hover{transform:translateX(-6px)}
  .ctrl--next:hover{transform:translateX(6px)}
  .ctrl:hover{box-shadow:0 12px 34px rgba(0,0,0,.4), 0 0 0 3px color-mix(in oklab, var(--accent) 35%, transparent)}
  @media (max-width: 640px){ .controls{bottom:calc(14px + env(safe-area-inset-bottom))} }

  .rail-markers{position:fixed; left:12px; top:50%; transform:translateY(-50%); z-index:61; display:flex; flex-direction:column; gap:10px}
  .marker{width:14px; height:14px; border-radius:999px; border:1px solid var(--border); background:color-mix(in oklab, var(--card) 85%, transparent); position:relative; cursor:pointer}
  .marker.is-active{background:linear-gradient(135deg, var(--accent), var(--accent2)); transform:scale(1.15)}
  .marker:hover::after, .marker:focus::after{content:attr(data-tip); position:absolute; left:160%; top:50%; transform:translateY(-50%); background:color-mix(in oklab, var(--card) 92%, transparent); border:1px solid var(--border); color:var(--fg); padding:8px 10px; border-radius:10px; white-space:nowrap; box-shadow:var(--shadow)}
  @media (max-width: 900px){
    .rail-markers{left:50%; top:auto; bottom:calc(78px + env(safe-area-inset-bottom)); transform:translateX(-50%); flex-direction:row; gap:12px}
    .marker{width:16px; height:16px}
    .marker:hover::after, .marker:focus::after{left:50%; top:-10px; transform:translate(-50%, -100%)}
  }

  /* View Transitions — slightly slower (1.9s) for a premium feel */
  .dir-right ::view-transition-old(root){ animation: slideOldR 1.9s ease both; }
  .dir-right ::view-transition-new(root){ animation: slideNewR 1.9s ease both; }
  .dir-left  ::view-transition-old(root){ animation: slideOldL 1.9s ease both; }
  .dir-left  ::view-transition-new(root){ animation: slideNewL 1.9s ease both; }
  @keyframes slideOldR{ from{opacity:1; transform:none} to{opacity:0; transform:translateX(-6%); filter:blur(2px)} }
  @keyframes slideNewR{ from{opacity:0; transform:translateX(6%); filter:blur(3px)} to{opacity:1; transform:none; filter:none} }
  @keyframes slideOldL{ from{opacity:1; transform:none} to{opacity:0; transform:translateX(6%); filter:blur(2px)} }
  @keyframes slideNewL{ from{opacity:0; transform:translateX(-6%); filter:blur(3px)} to{opacity:1; transform:none; filter:none} }
  .curtain{position:fixed; inset:0; pointer-events:none; z-index:80; background:radial-gradient(80vmax 80vmax at 50% 50%, rgba(255,255,255,.12), transparent 60%); clip-path:inset(0 100% 0 0); transition:clip-path 1.9s cubic-bezier(.2,.8,.2,1)}
  .curtain.show{clip-path:inset(0 0 0 0)}

  .btn-x{width:34px; height:34px; border-radius:10px; border:1px solid var(--border); background:color-mix(in oklab, var(--card) 85%, transparent); color:var(--fg)}

  /* Chat */
  #chatDock{position:fixed; right:calc(18px + env(safe-area-inset-right)); bottom:calc(18px + env(safe-area-inset-bottom)); width:min(440px, 96vw); height:min(66vh, 720px); display:grid; grid-template-rows:auto 1fr auto; background:color-mix(in oklab, var(--card) 92%, transparent); border:1px solid var(--border); border-radius:18px; box-shadow:var(--shadow); overflow:hidden; transform:translateY(16px) scale(.98); opacity:0; pointer-events:none; transition:opacity .2s ease, transform .2s ease; z-index:70}
  #chatDock.show{opacity:1; transform:none; pointer-events:auto}
  .chatHead{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid var(--border)}
  .chatBody{padding:12px; overflow:auto; display:grid; gap:10px}
  .msg{max-width:86%; padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:color-mix(in oklab, var(--card) 85%, transparent)}
  .msg.me{justify-self:end; background:linear-gradient(135deg, var(--accent), var(--accent2)); color:#07121c}
  .chatFoot{padding:10px; display:flex; gap:8px}
  .chatFoot input{flex:1; padding:12px; border-radius:12px; border:1px solid var(--border); background:color-mix(in oklab, var(--card) 80%, transparent); color:var(--fg)}
  .chatFoot button{padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:linear-gradient(135deg, var(--accent), var(--accent2)); color:#07121c; font-weight:700}

  /* Metrics */
  #metricsDock{position:fixed; right:0; top:0; bottom:0; width:min(380px, 92vw); transform:translateX(100%); transition:transform .25s ease; z-index:71}
  #metricsDock.show{transform:none}
  .metrics__panel{height:100%; display:grid; grid-template-rows:auto 1fr auto; gap:0; background:color-mix(in oklab, var(--card) 92%, transparent); border-left:1px solid var(--border); box-shadow:var(--shadow)}
  .metrics__panel header{display:flex; align-items:center; justify-content:space-between; padding:14px 14px; border-bottom:1px solid var(--border)}
  .metrics__panel h3{margin:0}
  .metrics__panel .body{padding:12px; display:grid; gap:10px; overflow:auto}
  .metrics__panel .row{display:flex; align-items:center; justify-content:space-between; border:1px dashed color-mix(in oklab, var(--accent) 25%, var(--border)); padding:10px 12px; border-radius:12px}
  .metrics__panel footer{padding:12px; color:var(--muted); font-size:12px}

  /* Podcast */
  #podcastDock{position:fixed; right:0; top:0; bottom:0; width:min(360px, 92vw); transform:translateX(100%); transition:transform .25s ease; z-index:72}
  #podcastDock.show{transform:none}
  .podcast__panel{height:100%; display:grid; grid-template-rows:auto 1fr auto; background:color-mix(in oklab, var(--card) 94%, transparent); border-left:1px solid var(--border); box-shadow:var(--shadow)}
  .podcast__panel header{display:flex; align-items:center; justify-content:space-between; padding:14px; border-bottom:1px solid var(--border)}
  .podcast__panel .body{padding:14px; overflow:auto; color:var(--muted); font-size:14px}
  .podcast__panel footer{padding:12px; border-top:1px solid var(--border); display:flex; gap:8px; align-items:center}
  .podcast__panel button{padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:color-mix(in oklab, var(--card) 85%, transparent); color:var(--fg)}
  .podcast__panel .act{background:linear-gradient(135deg, var(--accent), var(--accent2)); color:#07121c; font-weight:700}

  @media print{
    .bg,.bg2, .nav, .controls, #loader, .rail-markers, #chatDock, #metricsDock, #podcastDock{display:none!important}
    #rail{overflow:visible; display:block}
    .page{flex:none; max-width:unset}
    .card{border:1px solid #ccc}
  }
  </style>
</head>

<body>
  <!-- LOADER (Shows metadata from #p1 .meta-chip, progressbar, auto-hides) -->
  <div id="loader" role="status" aria-live="polite">
    <div class="loader__inner">
      <div class="loader__title">Welcome to <strong>Isarmiento</strong> Journey</div>
      <div class="loader__ticker" aria-live="polite" aria-atomic="true">
        <span id="kwTicker" class="loader__kw"></span>
      </div>
      <div class="loader__progress"
           role="progressbar"
           aria-label="Loading progress"
           aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="loader__bar" id="loaderBar"></div>
        <div class="loader__pct" id="loaderPct">0%</div>
      </div>
    </div>
  </div>

  <!-- Backgrounds -->
  <div class="bg" aria-hidden="true"></div>
  <div class="bg2" aria-hidden="true"></div>

  <!-- NAV -->
  <nav class="nav" aria-label="Primary">
    <div class="nav__inner">
      <div></div>
      <div class="brand-wrap">
        <a class="brand" id="brandLink" href="https://www.linkedin.com/in/ismael-sarmiento" target="_blank" rel="noopener">
          <span class="brand__l1">Ismael A. Sarmiento</span>
          <span class="brand__l2">Lead Data Engineer</span>
        </a>
        <div class="brand-hint" id="brandHint">“I keep six honest serving-men (they taught me all I knew): their names are What and Why and When and How and Where and Who.”<br><small>— Rudyard Kipling</small></div>
      </div>
      <div class="nav__actions">
        <!-- Tools -->
        <div class="menu" id="toolsMenuWrap" aria-expanded="false">
          <button id="toolsBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false" aria-controls="toolsMenu" title="Tools"><span class="ico ico-gear" aria-hidden="true"></span></button>
          <div id="toolsMenu" class="menu__list root" role="menu" aria-label="Tools">
            <div class="menu__row has-sub" aria-expanded="false">
              <button class="menu__parent" type="button" aria-haspopup="true" aria-expanded="false">AI</button>
              <div class="submenu" role="menu">
                <button role="menuitem" class="menu__item" id="openChat">Chat</button>
                <button role="menuitem" class="menu__item" id="openPodcast">CV Podcast</button>
              </div>
            </div>
            <div class="menu__row has-sub" aria-expanded="false">
              <button class="menu__parent" type="button" aria-haspopup="true" aria-expanded="false">Metrics</button>
              <div class="submenu" role="menu">
                <button role="menuitem" class="menu__item" id="openMetrics">Panel</button>
              </div>
            </div>
            <div class="menu__row has-sub" aria-expanded="false">
              <button class="menu__parent" type="button" aria-haspopup="true" aria-expanded="false">Resources</button>
              <div class="submenu" role="menu">
                <a role="menuitem" class="menu__item" href="./assets/Ismael_Sarmiento_CV.pdf" download>Download PDF</a>
                <a role="menuitem" class="menu__item" href="#p3">DAMA</a>
                <a role="menuitem" class="menu__item" href="#p3">Courses</a>
                <a role="menuitem" class="menu__item" href="#p3">Normative</a>
              </div>
            </div>
            <div class="menu__row has-sub" aria-expanded="false">
              <button class="menu__parent" type="button" aria-haspopup="true" aria-expanded="false">Navigation</button>
              <div class="submenu" role="menu">
                <button role="menuitem" class="menu__item" id="goStart">Back to start</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Language -->
        <div class="menu" id="langMenuWrap" aria-expanded="false">
          <button id="langBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false" aria-controls="langMenu" title="Languages"><span class="ico ico-globe" aria-hidden="true"></span></button>
          <div id="langMenu" class="menu__list" role="menu" aria-label="Available languages"></div>
        </div>

        <!-- Theme -->
        <button id="theme" class="icon-btn" aria-label="Toggle theme" title="Theme"><span class="ico ico-theme" aria-hidden="true"></span></button>
      </div>
    </div>
  </nav>

  <!-- Side markers -->
  <nav class="rail-markers" id="railMarkers" aria-label="Sections map"></nav>

  <!-- RAIL -->
  <main id="rail" tabindex="0" role="region" aria-label="Data Journey (horizontal sections)">
    <!-- P1 · ABOUT -->
    <section class="page page--about active" id="p1" data-tip="Who I am, approach and base stack">
      <div class="page__inner">
        <h1 class="title">About</h1>
        <p class="intro">Data Engineer focused on <strong>quality</strong>, <strong>governance</strong> and <strong>interoperability</strong>. I lead end-to-end teams and platforms in cloud and EHR with <strong>Apache Spark</strong>, <strong>AWS</strong> and <strong>Airflow</strong>, always chasing measurable impact and security by design.</p>
        <div class="card" aria-label="Professional metadata">
          <div class="meta-cloud">
            <span class="meta-chip" data-desc="Spark (Py/Scala): 6+ years; batch & streaming, tuning and optimization.">Apache Spark</span>
            <span class="meta-chip" data-desc="Airflow: orchestration of EHR pipelines, sensors, SLAs and modular DAGs.">Airflow</span>
            <span class="meta-chip" data-desc="AWS: EMR, S3, Glue, Lambda; IaC and cost-aware design.">AWS (EMR/S3/Glue/Lambda)</span>
            <span class="meta-chip" data-desc="DataHub: end-to-end lineage, catalog and enterprise metadata.">DataHub</span>
            <span class="meta-chip" data-desc="ClickHouse: columnar analytical store, quality reporting.">ClickHouse</span>
            <span class="meta-chip" data-desc="Leadership: standards, mentoring and value-driven prioritization.">Leadership</span>
            <span class="meta-chip" data-desc="Data security and compliance in healthcare environments.">Data Security</span>
          </div>
        </div>
      </div>
    </section>

    <!-- P2 · EXPERIENCE -->
    <section class="page page--experience" id="p2" data-tip="Career path and role achievements">
      <div class="page__inner">
        <h2 class="title">Experience</h2>
        <div class="exp-grid">
          <details class="accordion" open>
            <summary><span class="acc-title">Savana — Lead Data Engineer</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">Nov 2024 – Present · ES · DataHub · Data Quality on Spark · Airflow · AWS · ClickHouse</p>
              <ul>
                <li>Rollout of <strong>DataHub</strong> and large-scale metadata/lineage.</li>
                <li>Architecture for <strong>Data Quality</strong> on Spark + serverless AWS.</li>
                <li>EHR pipelines orchestrated with <strong>Airflow</strong> and EMR (profiling/cleansing).</li>
              </ul>
            </div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">Savana — Senior Data Engineer</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">Dec 2022 – Nov 2024 · ES</p>
              <ul>
                <li>Critical pipelines with <strong>Spark</strong> and automated quality checks.</li>
                <li>Reliability and observability improvements across data products.</li>
              </ul>
            </div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">StratioBD — Data Engineer</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">Oct 2021 – Dec 2022 · ES</p>
              <ul>
                <li>End-to-end flows with <strong>Spark</strong> and governed modeling (Logroño).</li>
                <li>E-bike demand prediction with PySpark (Bilbao).</li>
              </ul>
            </div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">Santander Global Tech — Software Engineer</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">Oct 2020 – Oct 2021 · ES</p>
              <ul>
                <li>Batch/stream platform with Spark, Flink, Kafka, Hazelcast; CI/CD.</li>
              </ul>
            </div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">BBVA Next Technologies — Software Developer</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">Mar 2018 – Oct 2020 · Madrid</p>
              <ul>
                <li>Helena (funds/pensions data), on-prem → AWS migration; serverless data processes.</li>
                <li>HappyNext (sentiment), DataCloud (POS stats).</li>
              </ul>
            </div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">Autana Consultores — Junior Software Developer</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">Dec 2017 – Mar 2018 · Madrid</p>
              <ul><li>Social & geospatial analytics (RED.es). First professional experience.</li></ul>
            </div>
          </details>
        </div>
      </div>
    </section>

    <!-- P3 · PROJECTS -->
    <section class="page page--projects" id="p3" data-tip="Highlighted cases with metrics and stack">
      <div class="page__inner">
        <h2 class="title">Projects</h2>
        <div class="proj-grid">
          <details class="accordion" open>
            <summary><span class="acc-title">Data Quality Platform (Savana)</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">Spark + AWS serverless + DataHub + ClickHouse</p>
              <ul>
                <li>Airflow + EMR for profiling/cleansing; KPI reporting.</li>
                <li>Lineage & metadata for end-to-end traceability.</li>
              </ul>
            </div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">E-bike demand prediction (Bilbao)</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">StratioBD · PySpark · Grafana/Prometheus · Mesos</p>
              <ul><li>Modeling and productive pipelines with Spark.</li></ul>
            </div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">Helena — funds/pensions data (BBVA Next)</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body">
              <p class="meta">AWS serverless · automation · governance</p>
              <ul><li>On-prem → AWS migration and standardization of data processes.</li></ul>
            </div>
          </details>
        </div>
      </div>
    </section>

    <!-- P4 · EDUCATION -->
    <section class="page page--education" id="p4" data-tip="Relevant academic background">
      <div class="page__inner">
        <h2 class="title">Education</h2>
        <div class="edu-grid">
          <details class="accordion" open>
            <summary><span class="acc-title">ULPGC — Industrial Technical Engineering</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body"><p class="meta">Feb 2023 – Apr 2025</p></div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">CUJAE (Havana) — Automation Engineer</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body"><p class="meta">2012 – 2017</p></div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">ASIME — Big Data Management, Technologies and Analytics</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body"><p class="meta">2017 – 2018</p></div>
          </details>
        </div>
      </div>
    </section>

    <!-- P5 · CERTS -->
    <section class="page page--certs" id="p5" data-tip="Certifications and complementary training">
      <div class="page__inner">
        <h2 class="title">Certifications & Courses</h2>
        <div class="cert-grid">
          <details class="accordion" open>
            <summary><span class="acc-title">AWS Certified Solutions Architect – Associate</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body"><p class="meta">Architecture on AWS, best practices and resilience.</p></div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">Building Data Lakes on AWS</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body"><p class="meta">Design and operation of data lakes on AWS.</p></div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">Stream Processing Patterns in Apache Flink</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body"><p class="meta">Real-time processing patterns.</p></div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">AWS Solutions Training for Partners: Machine Learning on AWS</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body"><p class="meta">ML services in AWS, integration and deployment.</p></div>
          </details>
          <details class="accordion">
            <summary><span class="acc-title">Data Centric Basics Exam</span><span class="chev" aria-hidden="true"></span></summary>
            <div class="acc-body"><p class="meta">Principles of data-centric design.</p></div>
          </details>
        </div>
      </div>
    </section>

    <!-- P6 · CONTACT -->
    <section class="page page--contact" id="p6" data-tip="Contact and links">
      <div class="page__inner">
        <h2 class="title">Contact</h2>
        <div class="card" style="max-width:760px; margin:0 auto; text-align:center">
          <p><strong>Email:</strong> <a href="mailto:ismaelantonio.sarmiento@gmail.com">ismaelantonio.sarmiento@gmail.com</a></p>
          <p><strong>LinkedIn:</strong> <a href="https://www.linkedin.com/in/ismael-sarmiento" target="_blank" rel="noopener">linkedin.com/in/ismael-sarmiento</a></p>
          <p><strong>Portfolio:</strong> <a href="https://ismael-sarmiento.github.io/" target="_blank" rel="noopener">ismael-sarmiento.github.io</a></p>
        </div>
      </div>
    </section>

    <!-- P7 · EASTER -->
    <section class="page page--easter" id="p7" data-tip="A treat at the end!">
      <div class="page__inner">
        <h2 class="title">Thanks for reaching the end!</h2>
        <div class="card" style="max-width:760px; margin:0 auto; text-align:center">
          <p>🎁 <strong>Gift:</strong> Connect with me here → <a href="https://www.linkedin.com/in/ismael-sarmiento" target="_blank" rel="noopener">My LinkedIn</a></p>
        </div>
      </div>
    </section>
  </main>

  <!-- PREV/NEXT -->
  <div class="controls" aria-hidden="false">
    <button class="ctrl ctrl--prev" id="prev" aria-label="Previous page">⇦</button>
    <button class="ctrl ctrl--next" id="next" aria-label="Next page">⇨</button>
  </div>
  <div class="curtain" id="curtain" aria-hidden="true"></div>

  <!-- Chat -->
  <section id="chatDock" aria-label="CV chat" aria-live="polite">
    <header class="chatHead"><strong>CV Assistant (in preparation)</strong> <button class="btn-x" id="closeChat" title="Close" aria-label="Close chat">✕</button></header>
    <div class="chatBody" id="chatBody" role="log" aria-live="polite"></div>
    <footer class="chatFoot">
      <input id="chatInput" type="text" placeholder="Type your question…" />
      <button id="chatSend">Send</button>
    </footer>
  </section>

  <!-- Metrics -->
  <aside id="metricsDock" role="dialog" aria-modal="false" aria-labelledby="metricsTitle">
    <div class="metrics__panel">
      <header><h3 id="metricsTitle">Metrics</h3> <button class="btn-x" id="closeMetrics" aria-label="Close metrics">✕</button></header>
      <div class="body">
        <div class="row"><span>Views (local)</span> <b id="viewsNum">0</b></div>
        <div class="row"><span>Visited sections</span> <b id="visitedNum">0</b></div>
        <div class="row"><span>Session time</span> <b id="sessTime">00:00</b></div>
        <div class="row"><span>Last visit</span> <b id="lastVisit">—</b></div>
        <div class="row"><span>Device</span> <b id="uaShort">—</b></div>
      </div>
      <footer>For real analytics, integrate Cloudflare Web Analytics or GA4 on your domain.</footer>
    </div>
  </aside>

  <!-- Podcast -->
  <aside id="podcastDock" role="dialog" aria-modal="false" aria-labelledby="podcastTitle">
    <div class="podcast__panel">
      <header><h3 id="podcastTitle">CV Podcast</h3> <button class="btn-x" id="closePodcast" aria-label="Close podcast">✕</button></header>
      <div class="body" id="podcastPreview">Generating summary…</div>
      <footer>
        <button id="podPlay" class="act">▶ Play</button>
        <button id="podPause">⏸ Pause</button>
        <button id="podStop">⏹ Stop</button>
      </footer>
    </div>
  </aside>

  <script>
  /* =======================================================================
     CONFIG (EDITABLE) — Loader timings and behavior
     ======================================================================= */
  const LOADER_CFG = {
    baseMin: 1000,   // min ms per keyword (normal mode)
    baseMax: 1900,   // max ms per keyword
    perChar: 24,     // additional ms per character
    maxTotal: 18000, // cap total time
    endPad: 600,     // final breathing time before hiding

    reducedMotion: { // when OS asks for less motion
      baseMin: 900,
      baseMax: 1500,
      perChar: 18,
      maxTotal: 8000,
      endPad: 300
    }
  };

  /* =======================================================================
     LOADER (Keywords + Progress Bar)
     - Pulls chips from #p1 .meta-chip
     - Shows them one by one (centered from first frame)
     - Progress bar synced with TOTAL_TIME
     - Honors prefers-reduced-motion
     ======================================================================= */
  (function(){
    const loader   = document.getElementById('loader');
    const ticker   = document.getElementById('kwTicker');
    const barEl    = document.getElementById('loaderBar');
    const pctEl    = document.getElementById('loaderPct');
    const progressContainer = document.querySelector('.loader__progress');

    // 1) Read metadata from P1 ("About")
    const chips = [...document.querySelectorAll('#p1 .meta-cloud .meta-chip')]
      .map(el => (el.textContent || '').trim())
      .filter(Boolean);

    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // 2) Fallback: no chips → progress only
    if (!chips.length){
      let p = 0;
      const step = () => {
        p = Math.min(1, p + 0.02);
        barEl.style.transform = `scaleX(${p})`;
        const pct = Math.round(p*100);
        pctEl.textContent = `${pct}%`;
        progressContainer.setAttribute('aria-valuenow', String(pct));
        if (p < 1) requestAnimationFrame(step);
        else setTimeout(()=> loader.classList.add('fade-out'), 320);
      };
      requestAnimationFrame(step);
      return;
    }

    // 3) Timings per keyword (adaptive by length)
    const cfg = reduceMotion ? LOADER_CFG.reducedMotion : LOADER_CFG;
    const raw = chips.map(w => 420 + (w.length * cfg.perChar));
    const clamped = raw.map(d => Math.max(cfg.baseMin, Math.min(cfg.baseMax, d)));
    const totalRaw = clamped.reduce((a,b)=>a+b,0);
    const factor = totalRaw > cfg.maxTotal ? (cfg.maxTotal / totalRaw) : 1;
    const durations = clamped.map(d => Math.max(520, Math.floor(d * factor)));
    const END_PAD = cfg.endPad;
    const TOTAL_TIME = durations.reduce((a,b)=>a+b,0) + END_PAD;

    // 4) Sequence through keywords
    let i = 0;
    function showNext(){
      const dwell = durations[i];
      const word  = chips[i];

      const prev = ticker.querySelector('.loader__kw');
      if (prev){
        prev.classList.add('loader__kw--out');
        setTimeout(()=> prev.remove(), reduceMotion ? 0 : 680);
      }

      const span = document.createElement('span');
      span.className = 'loader__kw';
      span.textContent = word;
      ticker.appendChild(span);

      i++;
      if (i < chips.length){
        setTimeout(showNext, dwell);
      } else {
        setTimeout(()=> loader.classList.add('fade-out'), END_PAD);
      }
    }

    // 5) Synced progress bar
    let start = null;
    function rafProgress(ts){
      if (!start) start = ts;
      const elapsed = ts - start;
      const ratio = Math.min(1, elapsed / TOTAL_TIME);
      barEl.style.transform = `scaleX(${ratio})`;
      const pct = Math.round(ratio * 100);
      pctEl.textContent = `${pct}%`;
      progressContainer.setAttribute('aria-valuenow', String(pct));
      if (ratio < 1) requestAnimationFrame(rafProgress);
    }

    function steppedProgress(){
      let acc = 0, idx = 0;
      const tick = () => {
        const stepTime = durations[idx] || END_PAD;
        acc += stepTime;
        const ratio = Math.min(1, acc / TOTAL_TIME);
        barEl.style.transform = `scaleX(${ratio})`;
        const pct = Math.round(ratio * 100);
        pctEl.textContent = `${pct}%`;
        progressContainer.setAttribute('aria-valuenow', String(pct));
        if (++idx <= durations.length) setTimeout(tick, stepTime);
      };
      setTimeout(tick, 50);
    }

    const startAll = () => {
      setTimeout(showNext, 140);
      if (reduceMotion) steppedProgress();
      else requestAnimationFrame(rafProgress);
    };
    if (document.readyState === 'complete') startAll();
    else window.addEventListener('load', startAll);
  })();

  /* =======================================================================
     Persistent theme (light/dark)
     ======================================================================= */
  (function(){
    const root=document.documentElement,key='theme-preference',btn=document.getElementById('theme');
    const get=()=>localStorage.getItem(key), set=v=>localStorage.setItem(key,v), apply=v=>root.setAttribute('data-theme',v);
    const stored=get(); if(stored) apply(stored);
    btn?.addEventListener('click',()=>{const cur=root.getAttribute('data-theme')|| (matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'); const next=cur==='dark'?'light':'dark'; apply(next); set(next);});
  })();

  /* =======================================================================
     Languages (show the alternatives to current language)
     ======================================================================= */
  (function(){
    const wrap=document.getElementById('langMenuWrap');
    const btn=document.getElementById('langBtn');
    const list=document.getElementById('langMenu');
    const current=document.documentElement.lang || 'en';
    const all=[{code:'es', label:'Español', href:'./index.html'}, {code:'en', label:'English', href:'./index_en.html'}];
    const items=all.filter(x=>x.code!==current);
    list.innerHTML = items.map(x=>`<a role="menuitem" class="menu__item" href="${x.href}" lang="${x.code}" hreflang="${x.code}">${x.label}</a>`).join('');
    const open=(v)=>{wrap.setAttribute('aria-expanded', v); btn.setAttribute('aria-expanded', v);};
    btn.addEventListener('click', (e)=>{ e.stopPropagation(); const v=wrap.getAttribute('aria-expanded')==='true'? 'false':'true'; open(v); });
    document.addEventListener('click', ()=> open('false'));
  })();

  /* =======================================================================
     Tools menu (with submenus)
     ======================================================================= */
  (function(){
    const wrap=document.getElementById('toolsMenuWrap');
    const btn=document.getElementById('toolsBtn');
    const open=(v)=>{wrap.setAttribute('aria-expanded', v); btn.setAttribute('aria-expanded', v);};
    btn.addEventListener('click', (e)=>{ e.stopPropagation(); const v=wrap.getAttribute('aria-expanded')==='true'? 'false':'true'; open(v); });
    document.addEventListener('click', ()=> open('false'));

    // Submenus
    wrap.querySelectorAll('.has-sub').forEach(row=>{
      const parent=row.querySelector('.menu__parent');
      parent.addEventListener('click', (e)=>{
        e.stopPropagation();
        const cur=row.getAttribute('aria-expanded')==='true';
        row.parentElement.querySelectorAll('.has-sub').forEach(r=>{ if(r!==row) r.setAttribute('aria-expanded','false'); });
        row.setAttribute('aria-expanded', String(!cur));
        parent.setAttribute('aria-expanded', String(!cur));
      });
    });

    // Actions
    document.getElementById('openChat').addEventListener('click', ()=>{ open('false'); toggleChat(true, true); });
    document.getElementById('openMetrics').addEventListener('click', ()=>{ open('false'); toggleMetrics(true); });
    document.getElementById('openPodcast').addEventListener('click', ()=>{ open('false'); togglePodcast(true, true); });
    document.getElementById('goStart').addEventListener('click', ()=>{ open('false'); if(window.goToIdx) window.goToIdx(0); });
  })();

  /* =======================================================================
     Chat drawer — Demo mode with “in preparation” notice
     ======================================================================= */
  (function(){
    const dock=document.getElementById('chatDock');
    const body=document.getElementById('chatBody');
    const input=document.getElementById('chatInput');
    const send=document.getElementById('chatSend');
    const close=document.getElementById('closeChat');

    function add(text, me=false){
      const el=document.createElement('div');
      el.className='msg'+(me?' me':'');
      el.textContent=text;
      body.appendChild(el);
      body.scrollTop=body.scrollHeight;
    }

    window.toggleChat=function(show, reset){
      dock.classList.toggle('show', !!show);
      if(show){
        input?.focus();
        if(reset){
          body.innerHTML='';
          add('👋 The CV assistant is NOT active yet. It’s being integrated with an LLM securely and will return soon. Meanwhile, this is a local demo with no model connection.');
        }
      }
    };

    send.addEventListener('click', ()=>{
      if(!input.value.trim()) return;
      const q=input.value.trim();
      add(q, true);
      input.value='';
      setTimeout(()=> add('🔒 I cannot answer real queries yet. I’m learning how to connect securely to an LLM. Back soon!', false), 300);
    });
    input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') send.click(); });
    close.addEventListener('click', ()=> toggleChat(false));
  })();

  /* =======================================================================
     Podcast (Web Speech API, reads “About” + first experiences)
     ======================================================================= */
  (function(){
    const dock=document.getElementById('podcastDock');
    const prev=document.getElementById('podcastPreview');
    const btnPlay=document.getElementById('podPlay');
    const btnPause=document.getElementById('podPause');
    const btnStop=document.getElementById('podStop');
    const btnClose=document.getElementById('closePodcast');

    let utter=null, speaking=false, paused=false;

    function buildPodcastText(){
      const name=document.querySelector('.brand__l1')?.textContent?.trim()||'Ismael A. Sarmiento';
      const role=document.querySelector('.brand__l2')?.textContent?.trim()||'Lead Data Engineer';
      const about=document.querySelector('.page--about .intro')?.textContent?.trim()||'';
      const exps=[...document.querySelectorAll('.page--experience .accordion summary .acc-title')].slice(0,2).map(e=>e.textContent.trim());
      const expTxt = exps.length ? `Key experiences: ${exps.join('; ')}.` : '';
      return `${name}, ${role}. ${about} ${expTxt}`;
    }

    function speak(text){
      const s = window.speechSynthesis;
      if(!s){ prev.textContent='Your browser does not support speech synthesis.'; return; }
      s.cancel();
      utter = new SpeechSynthesisUtterance(text);
      const voices = s.getVoices();
      const enVoice = voices.find(v=>/English|US|UK|GB|en-/i.test(v.lang+v.name)) || voices[0];
      if(enVoice) utter.voice = enVoice;
      utter.rate = 1.03; utter.pitch = 1; utter.volume = 1;
      utter.onend = ()=>{ speaking=false; paused=false; };
      s.speak(utter);
      speaking=true; paused=false;
    }

    function refreshPreview(){
      const t = buildPodcastText();
      prev.textContent = t;
      return t;
    }

    window.togglePodcast=function(show, reset){
      dock.classList.toggle('show', !!show);
      if(show){ const t=refreshPreview(); if(reset) speak(t); }
      else { window.speechSynthesis?.cancel(); speaking=false; paused=false; }
    };

    btnPlay.addEventListener('click', ()=>{
      const s=window.speechSynthesis;
      if(paused){ s.resume(); paused=false; return; }
      if(!speaking){ speak(refreshPreview()); }
    });
    btnPause.addEventListener('click', ()=>{ window.speechSynthesis?.pause(); paused=true; });
    btnStop.addEventListener('click', ()=>{ window.speechSynthesis?.cancel(); speaking=false; paused=false; });
    btnClose.addEventListener('click', ()=> togglePodcast(false));
  })();

  /* =======================================================================
     Metrics (local demo using localStorage)
     ======================================================================= */
  (function(){
    const dock=document.getElementById('metricsDock');
    const close=document.getElementById('closeMetrics');
    window.toggleMetrics=function(show){ updateMetrics(); dock.classList.toggle('show', !!show); };
    close.addEventListener('click', ()=>toggleMetrics(false));
    const key='isarmiento_total_views_en';
    const sess='isarmiento_session_seen_en';
    let n=parseInt(localStorage.getItem(key)||'0',10);
    if(!sessionStorage.getItem(sess)){
      n++; localStorage.setItem(key,String(n));
      sessionStorage.setItem(sess,'1');
      localStorage.setItem('isarmiento_last_visit_en', new Date().toISOString());
    }
    const t0 = Date.now();
    const visited = new Set(JSON.parse(sessionStorage.getItem('isarmiento_visited_en')||'[]'));

    function fmt(ms){ const s=Math.floor(ms/1000); const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return `${m}:${ss}`; }

    function updateMetrics(){
      document.getElementById('viewsNum').textContent = parseInt(localStorage.getItem(key)||'0',10);
      document.getElementById('visitedNum').textContent = visited.size;
      document.getElementById('sessTime').textContent = fmt(Date.now()-t0);
      const last = localStorage.getItem('isarmiento_last_visit_en');
      document.getElementById('lastVisit').textContent = last ? new Date(last).toLocaleString() : '—';
      const ua = navigator.userAgent.replace(/(\(.*?\))/g,'');
      document.getElementById('uaShort').textContent = ua.slice(0, 50) + (ua.length>50?'…':'');
    }

    setInterval(()=>{ if(dock.classList.contains('show')) updateMetrics(); }, 1000);
    window.__metricsVisited = visited;
  })();

  /* =======================================================================
     Journey nav + markers + transitions
     ======================================================================= */
  (function(){
    const rail=document.getElementById('rail');
    const pages=[...rail.querySelectorAll('.page')];
    const next=document.getElementById('next'), prev=document.getElementById('prev');
    const curtain=document.getElementById('curtain');
    const markers=document.getElementById('railMarkers');
    const dirClass=(d)=>{ document.documentElement.classList.remove('dir-left','dir-right'); document.documentElement.classList.add(d>0?'dir-right':'dir-left'); };
    let idx=0, locked=false;

    // Markers
    pages.forEach((p,i)=>{
      const m=document.createElement('button');
      m.className='marker'+(i===0?' is-active':'');
      m.dataset.i=i;
      m.setAttribute('data-tip', p.getAttribute('data-tip')||('Section '+(i+1)));
      m.addEventListener('click',()=>go(i));
      markers.appendChild(m);
    });

    function setActive(i){
      markers.querySelectorAll('.marker').forEach((m,j)=>m.classList.toggle('is-active', j===i));
      pages.forEach((p,j)=>p.classList.toggle('active', j===i));
      const v = window.__metricsVisited; v.add(i); sessionStorage.setItem('isarmiento_visited_en', JSON.stringify([...v]));
    }

    function transition(doStep, dir){
      dirClass(dir);
      if (document.startViewTransition){
        const vt = document.startViewTransition(()=>{ doStep(); });
        vt.finished.finally(()=> {locked=false;});
      } else {
        curtain.classList.add('show');
        setTimeout(()=>{ doStep(); setTimeout(()=>{ curtain.classList.remove('show'); locked=false; }, 520); }, 480);
      }
    }

    function go(i){
      if (locked || i===idx || i<0 || i>=pages.length) return; locked=true;
      const dir = i>idx ? 1 : -1;
      transition(()=>{
        idx=i; pages[i].scrollIntoView({behavior:'instant', inline:'start', block:'nearest'}); setActive(i); history.replaceState({}, '', '#'+pages[i].id);
      }, dir);
    }

    window.goToIdx = (i)=>go(i);

    next.onclick=()=>go(Math.min(idx+1, pages.length-1));
    prev.onclick=()=>go(Math.max(idx-1, 0));

    rail.addEventListener('keydown', (e)=>{ if(e.key==='ArrowRight'){e.preventDefault(); next.click();} if(e.key==='ArrowLeft'){e.preventDefault(); prev.click();} });

    // Wheel (debounced)
    let wheelTO=null;
    rail.addEventListener('wheel', (e)=>{
      if (locked) return; if (Math.abs(e.deltaX)+Math.abs(e.deltaY) < 10) return; e.preventDefault();
      clearTimeout(wheelTO); wheelTO=setTimeout(()=>{ (e.deltaY>0||e.deltaX>0) ? next.click() : prev.click(); }, 24);
    }, {passive:false});

    // Gestures
    let startX=null; rail.addEventListener('pointerdown', (e)=>{ startX=e.clientX; });
    rail.addEventListener('pointerup', (e)=>{ if(startX==null) return; const dx=e.clientX-startX; if (Math.abs(dx)>50){ dx<0? next.click(): prev.click(); } startX=null; });

    function syncIdx(){ const vw = rail.clientWidth; idx = Math.round(rail.scrollLeft / vw); setActive(idx); }
    rail.addEventListener('scroll', syncIdx, {passive:true}); window.addEventListener('resize', syncIdx); syncIdx();
  })();
  </script>
</body>
</html>
